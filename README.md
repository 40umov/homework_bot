# Telegram-bot

```
Телеграм-бот для отслеживания статуса проверки домашней работы на Яндекс.Практикум.
Присылает сообщения, когда статус изменен - взято в проверку, есть замечания, зачтено.
```

# Технологии:
- Python 3.9
- python-dotenv 0.19.0
- python-telegram-bot 13.7

# Описание работы проекта:

Импортируются необходимые библиотеки и пакеты:

    logging - для логирования работы бота;
    os - для получения переменных окружения;
    sys - для доступа к некоторым системным параметрам и функциям
          интерпретатора;
    time - для работы со временем;
    http - для работы с протоколом HTTP;
    requests - для выполнения HTTP-запросов к API;
    telegram - для работы с Telegram API;
    dotenv - для загрузки переменных окружения из файла .env;
    exeption - импотируем четыре исключения:
        EmptyResponseFromAPI - это исключение обозначает ошибку, связанную с
                               получением пустого ответа от API;
        NotForSend - это исключение, которое может возникнуть при попытке
                     отправить сообщение или данные не в том формате или не в
                     том контексте, в котором это допустимо;
        TelegramError - это исключение, которое может возникнуть при
                        взаимодействии с Telegram API. Такое исключение может
                        быть связано с различными ошибками, которые могут
                        произойти в процессе работы с Telegram API,
                        например: ошибки аутентификации, проблемы с сетевым
                        подключением, ограничениями на использование API и т.д.;
        WrongResponseCode - это исключение, которое может возникнуть при
                            выполнении запроса к API и получении ответа с
                            некорректным кодом ответа (response code). Например,
                            данное исключение может возникнуть, если запрос к
                            API вернул ответ с кодом, указывающим на ошибку
                            (например, 404 - страница не найдена,
                            500 - внутренняя ошибка сервера и т.д.).

Затем загружаются необходимые переменные окружения из файла .env:

    PRACTICUM_TOKEN - токен для доступа к API Яндекс.Практикума;
    TELEGRAM_TOKEN - токен для доступа к Telegram API;
    TELEGRAM_CHAT_ID - идентификатор чата Telegram, в который бот будет
                       отправлять сообщения.

Далее определены некоторые константы:

    RETRY_PERIOD - период между повторными запросами к API, когда ответ от API
                   не получен;
    ENDPOINT - URL-адрес API Яндекс.Практикума для запроса состояния проверки
               домашних заданий;
    HEADERS - HTTP-заголовок для авторизации в API Яндекс.Практикума;
    HOMEWORK_VERDICTS - словарь, который определяет сообщения, которые будут
                        отправлены в Telegram при различных статусах проверки
                        домашней работы.

Определены функции:

    send_message() - для отправки сообщений в Telegram;
    get_api_answer() - для выполнения запроса к API Яндекс.Практикума и
                       получения списка домашних заданий;
    check_response() - для проверки корректности ответа от API;
    parse_status() - для извлечения статуса проверки домашней работы и
                     формирования сообщения для отправки в Telegram;
    check_tokens() - для проверки наличия всех необходимых токенов.

В функции main() выполняются следующие действия:

    1. Проверка наличия токена. Если токен отсутствует, бот останавливается.

    2. Создание объекта бота, используя токен.

    3. Получение текущей метки времени и отправка сообщения о запуске бота.

    4. Инициализация переменной prev_msg, которая будет хранить предыдущее
       отправленное сообщение.

    5. В бесконечном цикле выполняются следующие действия:

       5.1 Вызов функции get_api_answer() для получения информации о домашних
           заданиях и сохранение текущей метки времени.

       5.2 Проверка полученной информации о домашних заданиях с помощью функции
           check_response(). Если есть новые задания, то вызывается функция
           parse_status() для формирования сообщения.

       5.3 Если сообщение отличается от предыдущего отправленного сообщения
           prev_msg, то отправляется новое сообщение с помощью функции
           send_message(), и предыдущее сообщение обновляется.

       5.4 Если сообщение не отличается от предыдущего, то сообщение логируется
           с помощью logging.info().

    6. Если происходит ошибка NotForSend, то логируется сообщение об ошибке, и
       программа продолжает работу.

    7. Если происходит любая другая ошибка, то логируется сообщение об ошибке,
       и если сообщение отличается от предыдущего отправленного сообщения
       prev_msg, то отправляется новое сообщение.

    8. После выполнения всех действий в цикле выполняется функция time.sleep()
       с периодом RETRY_PERIOD для задержки перед следующей итерацией.

В блоке if name == 'main':

    Выполняется инициализация настроек логирования с помощью
    logging.basicConfig(), и вызывается функция main().

# Получаем токены:

Зарегистрируйте бота в BotFather:<br>
<a href="https://t.me/BotFather" target="_blank">Регистрация бота и получение токена</a>

Получите токен в ЯндексПрактикум:<br>
<a href="https://oauth.yandex.ru/authorize?response_type=token&client_id=1d0b9dd4d652455a9eb710d450ff456a" target="_blank">Получить токен</a>

Получите id своего чата у бота Userinfobot:<br>
<a href="https://t.me/userinfobot" target="_blank">Получить свой id</a>

# Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:

```
git clone git@github.com:PashkaVRN/homework_bot.git
```

```
cd homework_bot
```

Cоздать и активировать виртуальное окружение:

```
python -m venv env
```

```
source env/bin/activate
```

Установить зависимости из файла requirements.txt:

```
python -m pip install --upgrade pip
```

```
pip install -r requirements.txt
```

Записать в переменные окружения (файл .env) необходимые ключи:
- токен профиля на Яндекс.Практикуме
- токен телеграм-бота
- свой ID в телеграме


Запустить проект:

```
python homework.py
```